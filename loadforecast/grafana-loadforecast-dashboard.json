{
  "dashboard": {
    "id": 41,
    "panels": [
      {
        "datasource": {
          "type": "influxdb",
          "uid": "byzPPbd4z"
        },
        "fieldConfig": {
          "defaults": {
            "custom": {
              "fillOpacity": 0,
              "lineWidth": 2,
              "showPoints": "never"
            },
            "unit": "watth"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "PV P50"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#73BF69",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineWidth",
                  "value": 3
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "PV P10"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#99CC99",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "PV P90"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#44AA44",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "id": 1,
        "targets": [
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p10\" or r._field == \"energy_wh_p50\" or r._field == \"energy_wh_p90\")\n  |> map(fn: (r) => ({r with _field: if r._field == \"energy_wh_p10\" then \"PV P10\" else if r._field == \"energy_wh_p50\" then \"PV P50\" else \"PV P90\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "A"
          }
        ],
        "title": "PV Forecast (Wh per 15min)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "influxdb",
          "uid": "byzPPbd4z"
        },
        "fieldConfig": {
          "defaults": {
            "custom": {
              "fillOpacity": 0,
              "lineWidth": 2,
              "showPoints": "never"
            },
            "unit": "watth"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Load P50"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#F2495C",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineWidth",
                  "value": 3
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Load P10"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#FF7383",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Load P90"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#C4162A",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 8
        },
        "id": 2,
        "targets": [
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p10\" or r._field == \"power_w_p50\" or r._field == \"power_w_p90\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n  |> map(fn: (r) => ({r with _field: if r._field == \"power_w_p10\" then \"Load P10\" else if r._field == \"power_w_p50\" then \"Load P50\" else \"Load P90\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "A"
          }
        ],
        "title": "Load Forecast (Wh per 15min)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "influxdb",
          "uid": "byzPPbd4z"
        },
        "description": "Positive = surplus, Negative = deficit. PV P10/P50/P90 minus Load P50.",
        "fieldConfig": {
          "defaults": {
            "custom": {
              "fillOpacity": 0,
              "lineWidth": 2,
              "showPoints": "never"
            },
            "unit": "watth"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Net P50"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#5794F2",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineWidth",
                  "value": 3
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Net P10"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#8AB8FF",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Net P90"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#3274D9",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 16
        },
        "id": 3,
        "targets": [
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "pv = from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p50\")\n\nload = from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p50\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n\njoin(tables: {pv: pv, load: load}, on: [\"_time\"])\n  |> map(fn: (r) => ({_time: r._time, _value: r._value_pv - r._value_load, _field: \"Net P50\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "pv = from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p10\")\n\nload = from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p50\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n\njoin(tables: {pv: pv, load: load}, on: [\"_time\"])\n  |> map(fn: (r) => ({_time: r._time, _value: r._value_pv - r._value_load, _field: \"Net P10\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "B"
          },
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "pv = from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p90\")\n\nload = from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p50\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n\njoin(tables: {pv: pv, load: load}, on: [\"_time\"])\n  |> map(fn: (r) => ({_time: r._time, _value: r._value_pv - r._value_load, _field: \"Net P90\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "C"
          }
        ],
        "title": "Energy Balance: PV - Load (Wh per 15min)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "influxdb",
          "uid": "byzPPbd4z"
        },
        "description": "Running total of PV - Load. PV P10/P50/P90 minus Load P50.",
        "fieldConfig": {
          "defaults": {
            "custom": {
              "fillOpacity": 0,
              "lineWidth": 2,
              "showPoints": "never"
            },
            "unit": "watth"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Cumulative P50"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#B877D9",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineWidth",
                  "value": 3
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Cumulative P10"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#CA95E5",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Cumulative P90"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#8F3BB8",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineStyle",
                  "value": {
                    "fill": "dash"
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 24
        },
        "id": 4,
        "targets": [
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "pv = from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p50\")\n\nload = from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p50\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n\njoin(tables: {pv: pv, load: load}, on: [\"_time\"])\n  |> map(fn: (r) => ({_time: r._time, _value: r._value_pv - r._value_load, _field: \"net\"}))\n  |> cumulativeSum()\n  |> map(fn: (r) => ({_time: r._time, _value: r._value, _field: \"Cumulative P50\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "pv = from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p10\")\n\nload = from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p50\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n\njoin(tables: {pv: pv, load: load}, on: [\"_time\"])\n  |> map(fn: (r) => ({_time: r._time, _value: r._value_pv - r._value_load, _field: \"net\"}))\n  |> cumulativeSum()\n  |> map(fn: (r) => ({_time: r._time, _value: r._value, _field: \"Cumulative P10\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "B"
          },
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "pv = from(bucket: \"pv_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"pv_forecast\" and r.inverter == \"total\")\n  |> filter(fn: (r) => r._field == \"energy_wh_p90\")\n\nload = from(bucket: \"load_forecast\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"load_forecast\")\n  |> filter(fn: (r) => r._field == \"power_w_p50\")\n  |> map(fn: (r) => ({r with _value: r._value * 0.25}))\n\njoin(tables: {pv: pv, load: load}, on: [\"_time\"])\n  |> map(fn: (r) => ({_time: r._time, _value: r._value_pv - r._value_load, _field: \"net\"}))\n  |> cumulativeSum()\n  |> map(fn: (r) => ({_time: r._time, _value: r._value, _field: \"Cumulative P90\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "C"
          }
        ],
        "title": "Cumulative Energy Balance (Wh)",
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "influxdb",
          "uid": "byzPPbd4z"
        },
        "description": "Orange: no intervention (hits 0% early). Green: optimized discharge (battery OFF 21:00-06:45, hits 0% at target 21:00).",
        "fieldConfig": {
          "defaults": {
            "custom": {
              "fillOpacity": 0,
              "lineWidth": 2,
              "showPoints": "never"
            },
            "max": 100,
            "min": 0,
            "unit": "percent"
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "Without Strategy"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#FF9830",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineWidth",
                  "value": 2
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "With Strategy"
              },
              "properties": [
                {
                  "id": "color",
                  "value": {
                    "fixedColor": "#73BF69",
                    "mode": "fixed"
                  }
                },
                {
                  "id": "custom.lineWidth",
                  "value": 3
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 24,
          "x": 0,
          "y": 32
        },
        "id": 5,
        "targets": [
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "from(bucket: \"energy_manager\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"soc_comparison\")\n  |> filter(fn: (r) => r.scenario == \"no_strategy\")\n  |> filter(fn: (r) => r._field == \"soc_percent\")\n  |> map(fn: (r) => ({_time: r._time, _value: r._value, _field: \"Without Strategy\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "A"
          },
          {
            "datasource": {
              "type": "influxdb",
              "uid": "byzPPbd4z"
            },
            "query": "from(bucket: \"energy_manager\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"soc_comparison\")\n  |> filter(fn: (r) => r.scenario == \"with_strategy\")\n  |> filter(fn: (r) => r._field == \"soc_percent\")\n  |> map(fn: (r) => ({_time: r._time, _value: r._value, _field: \"With Strategy\"}))\n  |> keep(columns: [\"_time\", \"_value\", \"_field\"])",
            "refId": "B"
          }
        ],
        "title": "Battery SOC: Without vs With Strategy",
        "type": "timeseries"
      }
    ],
    "refresh": "5m",
    "schemaVersion": 39,
    "tags": [
      "forecast",
      "load",
      "energy",
      "pv"
    ],
    "time": {
      "from": "now",
      "to": "now+48h"
    },
    "timezone": "browser",
    "title": "LoadForecast",
    "uid": "df9feonzp10xsc",
    "version": 19
  },
  "overwrite": true
}
